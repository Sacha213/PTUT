Index: app/src/main/res/layout/activity_main.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <Button\n        android:id=\"@+id/btnSend\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginEnd=\"4dp\"\n        android:layout_marginRight=\"4dp\"\n        android:text=\"Send\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\"\n        app:layout_constraintVertical_bias=\"0.96\" />\n\n    <EditText\n        android:id=\"@+id/etMessage\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"8dp\"\n        android:ems=\"10\"\n        android:hint=\"Enter message\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintEnd_toStartOf=\"@+id/btnSend\"\n        app:layout_constraintHorizontal_bias=\"1.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"@+id/btnSend\" />\n\n    <EditText\n        android:id=\"@+id/etToken\"\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:ems=\"10\"\n        android:hint=\"Enter Token\"\n        android:inputType=\"textPersonName\"\n        app:layout_constraintEnd_toStartOf=\"@+id/btnSend\"\n        app:layout_constraintHorizontal_bias=\"0.0\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/etMessage\" />\n\n\n</androidx.constraintlayout.widget.ConstraintLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_main.xml	(revision b05041bae579b391b64fe2bfb423c58f7a992101)
+++ app/src/main/res/layout/activity_main.xml	(date 1606163935000)
@@ -31,17 +31,6 @@
         app:layout_constraintStart_toStartOf="parent"
         app:layout_constraintTop_toTopOf="@+id/btnSend" />
 
-    <EditText
-        android:id="@+id/etToken"
-        android:layout_width="0dp"
-        android:layout_height="wrap_content"
-        android:ems="10"
-        android:hint="Enter Token"
-        android:inputType="textPersonName"
-        app:layout_constraintEnd_toStartOf="@+id/btnSend"
-        app:layout_constraintHorizontal_bias="0.0"
-        app:layout_constraintStart_toStartOf="parent"
-        app:layout_constraintTop_toBottomOf="@+id/etMessage" />
 
 
 </androidx.constraintlayout.widget.ConstraintLayout>
\ No newline at end of file
Index: app/src/main/java/com/example/myapplication/FindToken.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.myapplication\n\nimport android.content.Context\nimport android.content.Intent\nimport android.os.Bundle\nimport android.util.Log\nimport androidx.appcompat.app.AppCompatActivity\nimport com.google.firebase.firestore.FirebaseFirestore\nimport com.google.firebase.iid.FirebaseInstanceId\n\n\nclass FindToken : AppCompatActivity() {\n\n    private val TAG = \"FindToken\"\n\n    private var db: FirebaseFirestore? = null\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_findtoken)\n\n        db = FirebaseFirestore.getInstance()\n\n        FirebaseService.sharedPref = getSharedPreferences(\"sharedPref\", Context.MODE_PRIVATE)\n        FirebaseInstanceId.getInstance().instanceId.addOnSuccessListener {\n            FirebaseService.token = it.token\n            val newToken = it.token\n\n            val data = hashMapOf(\n                    \"token\" to newToken,\n                    \"ID\" to \"p1913943\"\n            )\n\n\n            db!!.collection(\"Users\").document().set(data)\n\n            /******************* Changement de page  */\n            val otherActivity = Intent(applicationContext, Information::class.java) //Ouverture d'une nouvelle activité\n\n            startActivity(otherActivity)\n\n            finish() //Fermeture de l'ancienne activité*/\n\n\n        }\n    }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/myapplication/FindToken.kt	(revision b05041bae579b391b64fe2bfb423c58f7a992101)
+++ app/src/main/java/com/example/myapplication/FindToken.kt	(date 1606150504000)
@@ -28,12 +28,11 @@
             val newToken = it.token
 
             val data = hashMapOf(
-                    "token" to newToken,
-                    "ID" to "p1913943"
+                    "token" to newToken
             )
 
 
-            db!!.collection("Users").document().set(data)
+            db!!.collection("Users").document("p1913943").set(data)
 
             /******************* Changement de page  */
             val otherActivity = Intent(applicationContext, Information::class.java) //Ouverture d'une nouvelle activité
Index: app/src/main/java/com/example/myapplication/MainActivity.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.myapplication\n\nimport android.os.Bundle\nimport android.util.Log\nimport androidx.appcompat.app.AppCompatActivity\nimport com.google.firebase.firestore.FirebaseFirestore\nimport com.google.firebase.messaging.FirebaseMessaging\nimport com.google.gson.Gson\nimport kotlinx.android.synthetic.main.activity_main.*\nimport kotlinx.coroutines.CoroutineScope\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.launch\n\n\n\n\nconst val TOPIC = \"/topics/myTopic\"\n\nclass MainActivity : AppCompatActivity() {\n\n    private var db: FirebaseFirestore? = null\n\n    private lateinit var myToken: String\n\n\n    val TAG = \"MainActivity\"\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n        db = FirebaseFirestore.getInstance()\n\n\n        db!!.collection(\"Users\")\n                .whereEqualTo(\"ID\", \"p1913943\")\n                .get()\n                .addOnCompleteListener { task ->\n                    if (task.isSuccessful) {\n                        for (document in task.result!!) {\n                            myToken = document.getString(\"Token\").toString()\n                        }\n                    } else {\n                        Log.w(TAG, \"Error getting documents.\", task.exception)\n                    }\n                }\n\n\n\n\n        FirebaseMessaging.getInstance().subscribeToTopic(TOPIC)\n\n        btnSend.setOnClickListener {\n            val message = etMessage.text.toString()\n            if(message.isNotEmpty()) {\n                PushNotification(\n                        NotificationData(message),\n                        myToken\n                ).also {\n                    sendNotification(it)\n                }\n            }\n        }\n    }\n\n    private fun sendNotification(notification: PushNotification) = CoroutineScope(Dispatchers.IO).launch {\n        try {\n            val response = RetrofitInstance.api.postNotification(notification)\n            if(response.isSuccessful) {\n                Log.d(TAG, \"Response: ${Gson().toJson(response)}\")\n            } else {\n                Log.e(TAG, response.errorBody().toString())\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, e.toString())\n        }\n    }\n\n\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/myapplication/MainActivity.kt	(revision b05041bae579b391b64fe2bfb423c58f7a992101)
+++ app/src/main/java/com/example/myapplication/MainActivity.kt	(date 1606153141000)
@@ -12,8 +12,6 @@
 import kotlinx.coroutines.launch
 
 
-
-
 const val TOPIC = "/topics/myTopic"
 
 class MainActivity : AppCompatActivity() {
@@ -32,19 +30,11 @@
 
 
         db!!.collection("Users")
-                .whereEqualTo("ID", "p1913943")
+                .document("p1913943")
                 .get()
-                .addOnCompleteListener { task ->
-                    if (task.isSuccessful) {
-                        for (document in task.result!!) {
-                            myToken = document.getString("Token").toString()
-                        }
-                    } else {
-                        Log.w(TAG, "Error getting documents.", task.exception)
-                    }
+                .addOnSuccessListener { document ->
+                    myToken = document.getString("token").toString()
                 }
-
-
 
 
         FirebaseMessaging.getInstance().subscribeToTopic(TOPIC)
Index: build.gradle
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Top-level build file where you can add configuration options common to all sub-projects/modules.\n\nbuildscript {\n    ext.kotlin_version = '1.3.72'\n    repositories {\n        google()\n        jcenter()\n        \n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:4.1.0'\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n        \n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n        classpath 'com.google.gms:google-services:4.3.3'\n    }\n}\n\nallprojects {\n    repositories {\n        google()\n        jcenter()\n        \n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- build.gradle	(revision b05041bae579b391b64fe2bfb423c58f7a992101)
+++ build.gradle	(date 1606209068000)
@@ -14,7 +14,7 @@
 
         // NOTE: Do not place your application dependencies here; they belong
         // in the individual module build.gradle files
-        classpath 'com.google.gms:google-services:4.3.3'
+        classpath 'com.google.gms:google-services:4.3.4'
     }
 }
 
